# Schema for IDEA:
# $schema: https://schema.golem.cloud/app/golem/1.4.2/golem.schema.json
# Schema for vscode-yaml:
# yaml-language-server: $schema=https://schema.golem.cloud/app/golem/1.4.2/golem.schema.json

# Field reference: https://learn.golem.cloud/app-manifest#field-reference
# Creating HTTP APIs: https://learn.golem.cloud/invoke/making-custom-apis

httpApi:
  definitions:
    social-net-rust-social-net-api:
      version: '0.0.1'
      routes:
        - method: GET
          path: /v1/social-net/users/search?{query}
          binding:
            type: default
            componentName: social-net-ts:social-net
            response: |
              let query: string = request.query.query;
              let agent = user-search-agent();
              let result = agent.search(query);
              match result {  ok(x) => {status: 200u64, body: ok(x)}, err(x) => {status: 400u64, body: err({message: x})} }
        - method: GET
          path: /v1/social-net/users/{user-id}
          binding:
            type: default
            componentName: social-net-ts:social-net
            response: |-
              let id: string = request.path.user-id;
              let agent = user-agent(id);
              let result = agent.get-user();
              match result {  some(x) => {status: 200u64, body: ok(x) }, none => {status: 404u64, body: err({message: "not found"})} }
        - method: PUT
          path: /v1/social-net/users/{user-id}/name
          binding:
            type: default
            componentName: social-net-ts:social-net
            response: |
              let id: string = request.path.user-id;
              let agent = user-agent(id);
              let name: string = request.body.name;
              let result = agent.set-name(name);
              match result {  ok(_) => {status: 200u64, body: ok({message: "name set"})}, err(x) => {status: 400u64, body: err({message: x})} }
        - method: PUT
          path: /v1/social-net/users/{user-id}/email
          binding:
            type: default
            componentName: social-net-ts:social-net
            response: |
              let id: string = request.path.user-id;
              let agent = user-agent(id);
              let email: string = request.body.email;
              let result = agent.set-email(email);
              match result {  ok(_) => {status: 200u64, body: ok({message: "email set"})}, err(x) => {status: 400u64, body: err({message: x})} }
        - method: POST
          path: /v1/social-net/users/{user-id}/posts
          binding:
            type: default
            componentName: social-net-ts:social-net
            response: |
              let id: string = request.path.user-id;
              let agent = user-posts-agent(id);
              let content: string = request.body.content;
              let result = agent.create-post(content);
              match result {  ok(x) => {status: 200u64, body: ok({post-id: x})}, err(x) => {status: 400u64, body: err({message: x})} }
        - method: GET
          path: /v1/social-net/users/{user-id}/posts
          binding:
            type: default
            componentName: social-net-ts:social-net
            response: |
              let id: string = request.path.user-id;
              let agent = user-posts-agent(id);
              let result = agent.get-posts();
              match result {  some(x) => {status: 200u64, body: ok(x) }, none => {status: 404u64, body: err({message: "not found"})} }
        - method: GET
          path: /v1/social-net/users/{user-id}/posts/search?{query}
          binding:
            type: default
            componentName: social-net-ts:social-net
            response: |
              let id: string = request.path.user-id;
              let query: string = request.query.query;
              let agent = user-posts-view-agent();
              let result = agent.get-posts-view(id, query);
              match result {  some(x) => {status: 200u64, body: ok(x) }, none => {status: 404u64, body: err({message: "not found"})} }
        - method: POST
          path: /v1/social-net/users/{user-id}/chats
          binding:
            type: default
            componentName: social-net-ts:social-net
            response: |
              let id: string = request.path.user-id;
              let agent = user-chats-agent(id);
              let participants = request.body.participants;
              let result = agent.create-chat(participants);
              match result {  ok(x) => {status: 200u64, body: ok({chat-id: x})}, err(x) => {status: 400u64, body: err({message: x})} }
        - method: GET
          path: /v1/social-net/users/{user-id}/chats
          binding:
            type: default
            componentName: social-net-ts:social-net
            response: |
              let id: string = request.path.user-id;
              let agent = user-chats-agent(id);
              let result = agent.get-chats();
              match result {  some(x) => {status: 200u64, body: ok(x) }, none => {status: 404u64, body: err({message: "not found"})} }
        - method: GET
          path: /v1/social-net/users/{user-id}/chats/search?{query}
          binding:
            type: default
            componentName: social-net-ts:social-net
            response: |
              let id: string = request.path.user-id;
              let query: string = request.query.query;
              let agent = user-chats-view-agent();
              let result = agent.get-chats-view(id, query);
              match result {  some(x) => {status: 200u64, body: ok(x) }, none => {status: 404u64, body: err({message: "not found"})} }
        - method: GET
          path: /v1/social-net/users/{user-id}/chats/updates?{since}
          binding:
            type: default
            componentName: social-net-ts:social-net
            response: |
              let id: string = request.path.user-id;
              let since: string = request.query.since;
              let agent = user-chats-updates-agent();
              let result = agent.get-chats-updates(id, some({timestamp: since}), none, none);
              match result {  some(x) => {status: 200u64, body: ok(x) }, none => {status: 404u64, body: err({message: "not found"})} }
        - method: GET
          path: /v1/social-net/users/{user-id}/timeline/posts?{query}
          binding:
            type: default
            componentName: social-net-ts:social-net
            response: |
              let id: string = request.path.user-id;
              let query: string = request.query.query;
              let agent = user-timeline-view-agent();
              let result = agent.get-posts-view(id, query);
              match result {  some(x) => {status: 200u64, body: ok(x) }, none => {status: 404u64, body: err({message: "not found"})} }
        - method: GET
          path: /v1/social-net/users/{user-id}/timeline/posts/updates?{since}
          binding:
            type: default
            componentName: social-net-ts:social-net
            response: |
              let id: string = request.path.user-id;
              let since: string = request.query.since;
              let agent = user-timeline-updates-agent();
              let result = agent.get-posts-updates(id, some({timestamp: since}), none, none);
              match result {  some(x) => {status: 200u64, body: ok(x) }, none => {status: 404u64, body: err({message: "not found"})} }
        - method: PUT
          path: /v1/social-net/users/{user-id}/connections
          binding:
            type: default
            componentName: social-net-ts:social-net
            response: |
              let id: string = request.path.user-id;
              let agent = user-agent(id);
              let user_id = request.body.user-id;
              let connection_type = request.body.connection-type;
              let result = agent.connect-user(user_id, connection_type);
              match result {  ok(_) => {status: 200u64, body: ok({message: "connected"})}, err(x) => {status: 400u64, body: err({message: x})} }
        - method: DELETE
          path: /v1/social-net/users/{user-id}/connections
          binding:
            type: default
            componentName: social-net-ts:social-net
            response: |
              let id: string = request.path.user-id;
              let agent = user-agent(id);
              let user_id = request.body.user-id;
              let connection_type = request.body.connection-type;
              let result = agent.disconnect-user(user_id, connection_type);
              match result {  ok(_) => {status: 200u64, body: ok({message: "disconnected"})}, err(x) => {status: 400u64, body: err({message: x})} }
        - method: GET
          path: /v1/social-net/posts/{post-id}
          binding:
            type: default
            componentName: social-net-ts:social-net
            response: |
              let id: string = request.path.post-id;
              let agent = post-agent(id);
              let result = agent.get-post();
              match result {  some(x) => {status: 200u64, body: ok(x) }, none => {status: 404u64, body: err({message: "not found"})} }
        - method: PUT
          path: /v1/social-net/posts/{post-id}/likes
          binding:
            type: default
            componentName: social-net-ts:social-net
            response: |
              let id: string = request.path.post-id;
              let user_id: string = request.body.user-id;
              let like_type = request.body.like-type;
              let agent = post-agent(id);
              let result = agent.set-like(user_id, like_type);
              match result {  ok(_) => {status: 200u64, body: ok({message: "set"})}, err(x) => {status: 400u64, body: err({message: x})} }
        - method: DELETE
          path: /v1/social-net/posts/{post-id}/likes/{user-id}
          binding:
            type: default
            componentName: social-net-ts:social-net
            response: |
              let id: string = request.path.post-id;
              let user_id: string = request.path.user-id;
              let agent = post-agent(id);
              let result = agent.remove-like(user_id);
              match result {  ok(_) => {status: 200u64, body: ok({message: "removed"})}, err(x) => {status: 400u64, body: err({message: x})} }
        - method: POST
          path: /v1/social-net/posts/{post-id}/comments
          binding:
            type: default
            componentName: social-net-ts:social-net
            response: |
              let id: string = request.path.post-id;
              let comment: string = request.body.content;
              let user_id: string = request.body.user-id;
              let parent_comment_id = request.body.parent-comment-id;
              let agent = post-agent(id);
              let result = agent.add-comment(user_id, comment, parent_comment_id);
              match result {  ok(x) => {status: 200u64, body: ok(x)}, err(x) => {status: 400u64, body: err({message: x})} }
        - method: DELETE
          path: /v1/social-net/posts/{post-id}/comments/{comment-id}
          binding:
            type: default
            componentName: social-net-ts:social-net
            response: |
              let id: string = request.path.post-id;
              let comment_id: string = request.path.comment-id;
              let agent = post-agent(id);
              let result = agent.remove-comment(comment_id);
              match result {  ok(_) => {status: 200u64, body: ok({message: "removed"})}, err(x) => {status: 400u64, body: err({message: x})} }
        - method: PUT
          path: /v1/social-net/posts/{post-id}/comments/{comment-id}/likes
          binding:
            type: default
            componentName: social-net-ts:social-net
            response: |
              let id: string = request.path.post-id;
              let comment_id: string = request.path.comment-id;
              let user_id: string = request.body.user-id;
              let like_type = request.body.like-type;
              let agent = post-agent(id);
              let result = agent.set-comment-like(comment_id, user_id, like_type);
              match result {  ok(_) => {status: 200u64, body: ok({message: "set"})}, err(x) => {status: 400u64, body: err({message: x})} }
        - method: DELETE
          path: /v1/social-net/posts/{post-id}/comments/{comment-id}/likes/{user-id}
          binding:
            type: default
            componentName: social-net-ts:social-net
            response: |
              let id: string = request.path.post-id;
              let comment_id: string = request.path.comment-id;
              let user_id: string = request.path.user-id;
              let agent = post-agent(id);
              let result = agent.remove-comment-like(comment_id, user_id);
              match result {  ok(_) => {status: 200u64, body: ok({message: "removed"})}, err(x) => {status: 400u64, body: err({message: x})} }
        - method: POST
          path: /v1/social-net/chats/{chat-id}/messages
          binding:
            type: default
            componentName: social-net-ts:social-net
            response: |
              let id: string = request.path.chat-id;
              let message: string = request.body.content;
              let user_id: string = request.body.user-id;
              let agent = chat-agent(id);
              let result = agent.add-message(user_id, message);
              match result {  ok(x) => {status: 200u64, body: ok(x)}, err(x) => {status: 400u64, body: err({message: x})} }
        - method: PATCH
          path: /v1/social-net/chats/{chat-id}/participants
          binding:
            type: default
            componentName: social-net-ts:social-net
            response: |
              let id: string = request.path.chat-id;
              let participants = request.body.participants;
              let agent = chat-agent(id);
              let result = agent.add-participants(participants);
              match result {  ok(_) => {status: 200u64, body: ok({message: "updated"})}, err(x) => {status: 400u64, body: err({message: x})} }
        - method: DELETE
          path: /v1/social-net/chats/{chat-id}/messages/{message-id}
          binding:
            type: default
            componentName: social-net-ts:social-net
            response: |
              let id: string = request.path.chat-id;
              let message_id: string = request.path.message-id;
              let agent = chat-agent(id);
              let result = agent.remove-message(message_id);
              match result {  ok(_) => {status: 200u64, body: ok({message: "removed"})}, err(x) => {status: 400u64, body: err({message: x})} }
        - method: PUT
          path: /v1/social-net/chats/{chat-id}/messages/{message-id}/likes
          binding:
            type: default
            componentName: social-net-ts:social-net
            response: |
              let id: string = request.path.chat-id;
              let message_id: string = request.path.message-id;
              let user_id: string = request.body.user-id;
              let like_type = request.body.like-type;
              let agent = chat-agent(id);
              let result = agent.set-message-like(message_id, user_id, like_type);
              match result {  ok(_) => {status: 200u64, body: ok({message: "set"})}, err(x) => {status: 400u64, body: err({message: x})} }
        - method: DELETE
          path: /v1/social-net/chats/{chat-id}/messages/{message-id}/likes/{user-id}
          binding:
            type: default
            componentName: social-net-ts:social-net
            response: |
              let id: string = request.path.chat-id;
              let message_id: string = request.path.message-id;
              let user_id: string = request.path.user-id;
              let agent = chat-agent(id);
              let result = agent.remove-message-like(message_id, user_id);
              match result {  ok(_) => {status: 200u64, body: ok({message: "removed"})}, err(x) => {status: 400u64, body: err({message: x})} }

  deployments:
    local:
      - domain: localhost:9006
        definitions:
          - social-net-rust-social-net-api

components:
  social-net-ts:social-net:
    templates: ts

    # Component environment variables can reference system environment variables with minijinja syntax:
    #
    #   env:
    #     ENV_VAR_1: "{{ ENV_VAR_1 }}"
    #     RENAMED_VAR_2: "{{ ENV_VAR_2 }}"
    #     COMPOSED_VAR_3: "{{ ENV_VAR_3 }}-{{ ENV_VAR_4}}"
    #
    env:
    # LLM providers
    # -------------

    ## Common
    # GOLEM_LLM_LOG: "trace" # Optional, defaults to warn

    ## Anthropic
    # ANTHROPIC_API_KEY: "<KEY>"

    ## OpenAI
    # OPENAI_API_KEY: "<KEY>"

    ## OpenRouter
    # OPENROUTER_API_KEY: "<KEY>"

    ## Amazon Bedrock
    # AWS_ACCESS_KEY_ID: "<KEY>"
    # AWS_REGION: "<REGION>"
    # AWS_SECRET_ACCESS_KEY: "<KEY>"
    # AWS_SESSION_TOKEN: "<TOKEN>" # Optional

    ## Grok
    # XAI_API_KEY: "<KEY>"

    ## Ollama
    # GOLEM_OLLAMA_BASE_URL: "<URL>" # Optional, defaults to http://localhost:11434


    # Embedding providers
    # -------------------

    ## OpenAI
    # OPENAI_API_KEY: "<KEY>"

    ## Cohere
    # COHERE_API_KEY: "<KEY>"

    ## HuggingFace
    # HUGGING_FACE_API_KEY: "<KEY>"

    ## VoyageAI
    # VOYAGEAI_API_KEY: "<KEY>"


    # Graph database providers
    # ------------------------

    ## ArangoDB
    # ARANGODB_HOST: "<HOST>"
    # ARANGODB_PORT: "<PORT>" # Optional, defaults to 8529
    # ARANGODB_USER: "<USER>"
    # ARANGODB_PASSWORD: "<PASS>"
    # ARANGO_DATABASE: "<DB>"

    ## JanusGraph
    # JANUSGRAPH_HOST: "<HOST>"
    # JANUSGRAPH_PORT: "<PORT>" # Optional, defaults to 8182
    # JANUSGRAPH_USER: "<USER>"
    # JANUSGRAPH_PASSWORD: "<PASS>"

    ## Neo4j
    # NEO4J_HOST: "<HOST>"
    # NEO4J_PORT: "<PORT>" # Optional, defaults to 7687
    # NEO4J_USER: "<USER>"
    # NEO4J_PASSWORD: "<PASS>"


    # Search providers
    # ----------------

    ## Common
    # GOLEM_SEARCH_LOG: "trace" # Optional, defaults to warn

    ## Algolia
    # ALGOLIA_APPLICATION_ID: "<ID>"
    # ALGOLIA_API_KEY: "<KEY>"

    ## ElasticSearch
    # ELASTICSEARCH_URL: "<URL>"
    # ELASTICSEARCH_USERNAME: "<USERNAME>"
    # ELASTICSEARCH_PASSWORD: "<PASSWORD>"
    # ELASTICSEARCH_API_KEY: "<API_KEY>"

    ## Meilisearch
    # MEILISEARCH_BASE_URL: "<URL>"
    # MEILISEARCH_API_KEY: "<KEY>"

    ## OpenSearch
    # OPENSEARCH_BASE_URL: "<URL>"
    # OPENSEARCH_USERNAME: "<USER>"
    # OPENSEARCH_PASSWORD: "<PASS>"
    # OPENSEARCH_API_KEY: "<KEY>"

    ## Typesense
    # TYPESENSE_BASE_URL: "<URL>"
    # TYPESENSE_API_KEY: "<KEY>"


    # Speech-to-text providers
    # ------------------------

    ## Common
    # STT_PROVIDER_LOG_LEVEL: "trace" # Optional, defaults to warn
    # STT_PROVIDER_MAX_RETRIES: "10" # Optional, defaults to 10

    ## AWS
    # AWS_REGION: "<REGION>"
    # AWS_ACCESS_KEY: "<KEY>"
    # AWS_SECRET_KEY: "<KEY>"
    # AWS_BUCKET_NAME: "<BUCKET>"

    ## Azure
    # AZURE_REGION: "<REGION>"
    # AZURE_SUBSCRIPTION_KEY: "<KEY>"

    ## Deepgram
    # DEEPGRAM_API_TOKEN: "<TOKEN>"
    # DEEPGRAM_ENDPOINT: "<URL>" # Optional

    ## Google
    # GOOGLE_LOCATION: ""
    # GOOGLE_BUCKET_NAME: ""
    # GOOGLE_APPLICATION_CREDENTIALS: "<CRED>" # or use the vars below
    # GOOGLE_PROJECT_ID: "<ID>"
    # GOOGLE_CLIENT_EMAIL: "<EMAIL>"
    # GOOGLE_PRIVATE_KEY: "<KEY>"

    ## Whisper
    # OPENAI_API_KEY: "<KEY>"


    # Video generation providers
    # --------------------------

    ## Kling
    # KLING_ACCESS_KEY: "<KEY>"
    # KLING_SECRET_KEY: "<KEY>"

    ## Runway
    # RUNWAY_API_KEY: "<KEY>"

    ## Stability
    # STABILITY_API_KEY: "<KEY>"

    ## Veo
    # VEO_PROJECT_ID: "<ID>"
    # VEO_CLIENT_EMAIL: "<EMAIL>"
    # VEO_PRIVATE_KEY: "<KEY>"


    # WebSearch providers
    # -------------------

    ## Brave
    # BRAVE_API_KEY: "<KEY>"

    ## Google
    # GOOGLE_API_KEY: "<KEY>"
    # GOOGLE_SEARCH_ENGINE_ID: "<ID>"

    ## Serper
    # SERPER_API_KEY: "<KEY>"

    ## Tavily
    # TAVILY_API_KEY: "<KEY>"

    dependencies:
    # The following block contains commented-out dependencies for various Golem AI libraries.
    # For each area (such as LLM, Search, etc) only one of the providers can be commented out.
    # If no provider dependency is commented out, then using that AI API will be a runtime failure.
    # LLM providers
    # -------------

    ## Anthropic
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_llm_anthropic.wasm

    ## OpenAI
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_llm_openai.wasm

    ## OpenRouter
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_llm_openrouter.wasm

    ## Amazon Bedrock
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_llm_bedrock.wasm

    ## Grok
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_llm_grok.wasm

    ## Ollama
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_llm_ollama.wasm


    # Code execution providers
    # ------------------------

    ## Python and JavaScript
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_exec.wasm

    ## Python only
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_exec_python.wasm

    ## JavaScript only
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_exec_javascript.wasm


    # Embedding providers
    # -------------------

    ## OpenAI
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_embed_openai.wasm

    ## Cohere
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_embed_cohere.wasm

    ## HuggingFace
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_embed_hugging_face.wasm

    ## VoyageAI
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_embed_voyageai.wasm


    # Graph database providers
    # ------------------------

    ## ArangoDB
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_graph_arangodb.wasm

    ## JanusGraph
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_graph_janusgraph.wasm

    ## Neo4j
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_graph_neo4j.wasm


    # Search providers
    # ----------------

    ## Algolia
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_search_algolia.wasm

    ## ElasticSearch
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_search_elasticsearch.wasm

    ## Meilisearch
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_search_meilisearch.wasm

    ## OpenSearch
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_search_opensearch.wasm

    ## Typesense
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_search_typesense.wasm


    # Speech-to-text providers
    # ------------------------

    ## AWS
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_stt_aws.wasm

    ## Azure
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_stt_azure.wasm

    ## Deepgram
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_stt_deepgram.wasm

    ## Google
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_stt_google.wasm

    ## Whisper
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_stt_whisper.wasm


    # Video generation providers
    # --------------------------

    ## Kling
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_video_kling.wasm

    ## Runway
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_video_runway.wasm

    ## Stability
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_video_stability.wasm

    ## Veo
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_video_veo.wasm


    # WebSearch providers
    # -------------------

    ## Brave
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_web_search_brave.wasm

    ## Google
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_web_search_google.wasm

    ## Serper
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_web_search_serper.wasm

    ## Tavily
    # - type: wasm
    #   url: https://github.com/golemcloud/golem-ai/releases/download/v0.4.0/golem_web_search_tavily.wasm

